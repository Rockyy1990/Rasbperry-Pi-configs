# Raspberry Pi 5

# Config

# OS; Raspberry OS Lite 64bit

# On bootet Rasperry Pi (Linux)
# ssh: USERNAME@<IP-ADRESS>   
# On Error; WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED! @
# ssh-keygen -R 192.168.0.3

-----------------------------------------------------------------------------------------

# Recommended /boot/config.txt Settings for Raspberry Pi 5

# Enable the onboard audio (loads snd_bcm2835)
dtparam=audio=on

# Overclocking settings (optional)
# Uncomment and adjust these settings if you want to overclock
# over_voltage=6
# arm_freq=2200

# Set the GPU memory split (gpu_men=16 for terminal based use only)
gpu_mem=128

# Enable the 64-bit kernel (if not already enabled)
arm_64bit=1

# Set the HDMI output to a specific mode (optional)
hdmi_group=1
hdmi_mode=16  # 1080p @ 60Hz

# Enable USB boot (if needed)
program_usb_boot_mode=1

# Enable the camera interface (if using a camera)
start_x=1

# Enable the I2C interface (if using I2C devices)
dtparam=i2c_arm=on

# Enable SPI interface (if using SPI devices)
dtparam=spi=on

# Enable the 1-wire interface (if using 1-wire devices)
dtoverlay=w1-gpio

# Enable the GPIO pins (if needed)
# dtoverlay=gpio-keys

# Set the maximum CPU temperature (optional)
# temp_limit=85

# Disable the rainbow splash screen (optional)
disable_splash=1

# Set the boot delay (optional)
boot_delay=0

# Enable the serial console (if needed)
enable_uart=1

# Set the HDMI safe mode (optional)
hdmi_safe=1

# Uncomment to enable the Pi-hole DNS server (if using Pi-hole)
# dtoverlay=pi3-disable-bt

# Uncomment to enable the Pi-hole DHCP server (if using Pi-hole)
# dhcp-range=192.168.1.100,192.168.1.200,24h
-----------------------------------------------------------------------------

# Rasperry Shutdown (Version 5 and newer): 1. Power Button  2. over ssh: sudo poweroff

sudo apt update
sudo apt upgrade -y
sudo apt dist-upgrade -y
sudo apt autoremove -y
sudo systemctl enable fstrim.timer

# Set root passwod (if is not allready set)
sudo passwd root


# Install basic needed packages
sudo apt install -y binutils binfmt-support fakeroot hdparm sdparm flashrom smartmontools quota rsync xfsdump mtools curl ufw
sudo apt install -y samba openssl libnss-winbind apache2 rpi-update autodir autofs  
sudo apt install -y htop powertop libpam-winbind libpam-runtime python3 python3-pip unzip ffmpeg rtkit

# Firmware update
sudo rpi-update

(you can set: conservative ondemand userspace powersave performance schedutil)
echo schedutil | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor


# Static ipv6 address for the Raspberry Pi (if needed)
sudo nano /etc/dhcpcd.conf

interface eth0  # oder wlan0, je nach Verbindung
# IPv6 PrÃ¤fix: 2a02:2454:9b5c:3a00::/64
static ip6_address=2a02:2454:9b5c:3a00::10/64  



# UFW port settings (optimized for security)
# ufw limit is set to 6 connections

sudo ufw default deny incoming
sudo ufw default allow outgoing

sudo ufw allow ssh
sudo ufw limit ssh
sudo ufw allow 53/tcp
sudo ufw allow 53/udp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp 
sudo ufw limit http
sudo ufw limit https                              

sudo ufw allow 9090/tcp                              # Needed for Cockpit

sudo ufw allow from 192.168.1.0/24 to any port 80
sudo ufw allow from 192.168.1.0/24 to any port 443   # Optional

sudo ufw allow 10000/tcp                             # Needed for Webmin
sudo ufw allow 3000                                  # Needed for first config (adguardhome, grafana etc)
sudo ufw allow 90/tcp  	                             # Needed if Port 80 not ready for adguard							 

sudo ufw enable

# After add more rules after config (reload ufw)
sudo ufw reload

-------------------------------------------------------------------

Script for automatic system upgrades with logging every 6 days:

#!/bin/bash

# Scriptname: auto_update.sh

# Log-file for system updates
LOGFILE="/var/log/auto_update.log"

# Update and Upgrade
echo "Starting sytem update: $(date)" >> $LOGFILE
sudo apt update >> $LOGFILE 2>&1
sudo apt upgrade -y >> $LOGFILE 2>&1
sudo apt dist-upgrade -y >> $LOGFILE 2>&1
sudo apt autoremove -y >> $LOGFILE 2>&1
sudo apt autoclean -y >> $LOGFILE 2>&1
echo "System update complete: $(date)" >> $LOGFILE


# copy and save this script at /usr/local/bin
sudo nano /usr/local/bin/auto_update.sh

# make it executable
sudo chmod +x /usr/local/bin/auto_update.sh

# set the cronjob for the system upgrade
crontab -e

0 3 */6 * * /usr/local/bin/auto_update.sh

----------------------------------------------------------------------

# Webmin
curl -o webmin-setup-repos.sh https://raw.githubusercontent.com/webmin/webmin/master/webmin-setup-repos.sh
sudo sh webmin-setup-repos.sh

sudo apt install webmin --install-recommends

# After install and config.
https://<IP-Adress>:10000


# Installing Cockpit (Web Interface)
sudo apt install cockpit cockpit-bridge cockpit-networkmanager cockpit-packagekit cockpit-pcp cockpit-storaged    
sudo apt install pcockpit-podman podman 
sudo systemctl enable cockpit
sudo systemctl start cockpit

Webbrowser
http://<ip_address>:9090



# MiniDLNA Server (Video,Audio streaming)
sudo apt install -y minidlna

# Now you must config them 

# Example (A=Audio, P= Pictures, V=Video)
media_dir=A,/mnt/mediaDrive/audio
media_dir=P,/mnt/mediaDrive/pictures
media_dir=V,/mnt/mediaDrive/videos

# Search for "#friendly_name=" and set a name for the dlna server

sudo nano /etc/minidlna.conf

# After setting up the dlna server
sudo systemctl restart minidlna
sudo ufw allow 8200/tcp (if you use ufw firewall)



# Install Grafana (Monitoring)
sudo mkdir -p /etc/apt/keyrings/
wget -q -O - https://apt.grafana.com/gpg.key | gpg --dearmor | sudo tee /etc/apt/keyrings/grafana.gpg > /dev/null
echo "deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main" | sudo tee /etc/apt/sources.list.d/grafana.list
sudo apt-get update
sudo apt-get install -y grafana

sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable grafana-server
sudo /bin/systemctl start grafana-server

# First access after install 
http://<RASPBERRYPI_IP>:3000

--
Login: 
Username: admin
Password: admin
-> set a new password
--



# Install Pi-Hole
curl -sSL https://install.pi-hole.net | bash

# After install and config. 
http://<IP-Adress>/admin


# Install Adguard Home
curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v

# After install for config
http://<IP-Adress>:3000



# Set APM and HDD Spindown/Idle for HDD (hdparm) (set /dev/sda to the right disk like /dev/sdb)

# hdparm -B 254 for performance
# hdparm -B 127 for powersaving

sudo touch /etc/udev/rules.d/69-hdparm.rules

echo "
ACTION=="add", SUBSYSTEM=="block", KERNEL=="sda", RUN+="/usr/sbin/hdparm -B 127 -S 240 /dev/sda"
" | sudo tee /etc/udev/rules.d/69-hdparm.rules

# Reload udev rules
sudo udevadm control --reload-rules
sudo udevadm trigger
# (to ensure the udev rules are load correctly you should restart the raspberry pi)



# Set Spindown over an systemctl service

# Creating the hdd spindown service
sudo nano /etc/systemd/system/hdd-spindown.service

[Unit]
Description=Spindown HDD

[Service]
Type=simple
ExecStart=/usr/sbin/hdparm -B 127 -S 240 -y /dev/sda

[Install]
WantedBy=multi-user.target

# Enable the service
sudo systemctl enable hdd-spindown.service





# Webserver with Lighttpd
Lighttpd without php supports static webseites. (HTML, CSS and JavaScript)

sudo apt install lighttpd -y

Now you can put static files (HTML, CSS, JavaScript) in this directory: /var/www/html/

After this you must restart lighttpd:

sudo service lighttpd restart

Webbrowser:

http://<ip-address>/index.html







